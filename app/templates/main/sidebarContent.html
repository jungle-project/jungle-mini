<div class="flex flex-col items-center">
    <div class="flex justify-between mt-3 mb-3">
        <p class="w-30">받은 사람</p>
        <p>코멘트</p>
    </div>

    <!-- JS가 내용을 주입할 자리 -->
    <div id="topPraiseList" class="space-y-1 text-center"></div>

    <script>
        let topTimer = null; // 하나의 타이머만 관리
        let currentMode = ''; // 현재 실행 중인 모드 기록

        async function fetchJSON(path) {
            const res = await fetch(path, { credentials: 'include' });
            if (!res.ok) throw new Error('API');
            return res.json();
        }

        /* ---------- 두 모드 로더 ---------- */
        async function loadLikeTop() {
            const data = await fetchJSON('/praises/top?limit=10');
            renderList(data.map((p, i) => `${i + 1}. ${p.receiver} - “${p.content}”`));
        }

        async function loadUserTop() {
            const data = await fetchJSON('/api/users/top?limit=10');
            renderList(data.map((u, i) => `${i + 1}. ${u.name} ( ${u.praises}회 )`));
        }

        /* ---------- 목록 그리기 ---------- */
        function renderList(lines) {
            document.getElementById('top10-list').innerHTML =
                lines.map(t => `<li class='text-left w-70 overflow-hidden truncate'>${t}</li>`).join('');
        }

        /* ---------- 탭 활성화 + 타이머 제어 ---------- */
        function activate(loadFn, activeBtn, inactiveBtn, mode) {
            if (currentMode === mode) return; // 동일 모드 재클릭 방지

            clearInterval(topTimer); // 기존 타이머 정지
            currentMode = mode;      // 모드 갱신

            // UI 토글
            inactiveBtn.classList.remove('bg-blue-700', 'font-semibold');
            activeBtn.classList.add('bg-blue-700', 'font-semibold');

            // 즉시 실행 + 주기 실행
            loadFn().catch(console.error);
            topTimer = setInterval(() => loadFn().catch(console.error), 1000);
        }

        /* ---------- 이벤트 바인딩 ---------- */
        document.addEventListener('DOMContentLoaded', () => {
            const btnLike = document.getElementById('btn-like-top10');
            const btnUser = document.getElementById('btn-user-top10');

            btnLike.onclick = () => activate(loadLikeTop, btnLike, btnUser, 'like');
            btnUser.onclick = () => activate(loadUserTop, btnUser, btnLike, 'user');

            // 기본 모드
            activate(loadLikeTop, btnLike, btnUser, 'like');
        });
    </script>


    <ul id="top10-list" class="space-y-1 text-center"></ul>
</div>