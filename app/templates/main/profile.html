<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>칭찬 프로필</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body class="max-w-md mx-auto p-6">

  <h2 id="profileTitle" class="text-xl font-bold mb-4">님의 프로필</h2>
  <img id="profilePhoto" src="https://via.placeholder.com/100" class="rounded-full w-24 h-24 mb-4" />

  <h3 class="text-lg font-semibold mb-2">받은 칭찬 목록</h3>
  <ul id="praiseList" class="space-y-2"></ul>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // 1) sessionStorage에서 selectedUserProfile 꺼내기
      const raw = sessionStorage.getItem('selectedUserProfile');
      if (!raw) {
        alert('조회할 사용자 정보가 없습니다.');
        return;
      }
      // 2) 꺼낸 직후 세션스토리지에서 제거 (한 번만 사용)
      sessionStorage.removeItem('selectedUserProfile');

      const user = JSON.parse(raw);

      // 3) 제목과 프로필 사진 렌더링
      document.getElementById('profileTitle').innerText = `${user.name}님의 프로필`;
      document.getElementById('profilePhoto').src = user.photo;

      try {
        // 4) 받은 칭찬 목록 호출
        const praisesRes = await fetch(`/praises/received/${user.id}`, {
          credentials: 'include'
        });
        if (!praisesRes.ok) throw new Error('칭찬 목록을 불러오는 데 실패했습니다.');
        const praises = await praisesRes.json();

        // 5) 칭찬 목록 렌더링
        const listEl = document.getElementById('praiseList');
        listEl.innerHTML = '';
        if (praises.length === 0) {
          listEl.innerHTML = `<li class="text-gray-500">받은 칭찬이 없습니다.</li>`;
        } else {
          praises.forEach(p => {
            listEl.innerHTML += `
              <li class="border p-2 rounded shadow-sm">
                <div class="text-sm text-gray-700">작성자: ${p.from_name || p.from_id}</div>
                <div class="mt-1">${p.content}</div>
                <div class="text-xs text-gray-500 mt-1">공감 수: ${p.like_count ?? 0}</div>
                <div class="text-xs text-gray-400">${new Date(p.created_at).toLocaleDateString()}</div>
              </li>
            `;
          });
        }
      } catch (err) {
        console.error(err);
        alert(err.message);
      }
    });
  </script>
</body>

</html>
