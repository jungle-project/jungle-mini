<div id="modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center hidden">
  <div class="bg-white rounded-lg p-8 max-w-md w-full">
    <img src="">
    <p class="text-gray-700 mb-6">환영합니다!<br>여기선 비난 대신 칭찬이 쌓이고, 따뜻한 말들이 자유롭게 흘러갑니다. 오늘, 누군가의 하루를 환하게 밝혀줄 칭찬 한마디 남겨보는 건
      어때요?</p>
    <span onclick="closeModal()" class="text-blue-600 font-bold cursor-pointer">
      칭찬하러가기
    </span>
  </div>
</div>

<div class=" p-6 w-220">
  <div class="max-w-5xl mx-auto">
    <div class="flex justify-between items-center mb-4">
      <input id="searchInput" type="text" placeholder="이름 검색" class="border rounded px-5 py-1" oninput="filterUsers()">
      <div class="flex justify-end"><select id="sortSelect" onchange="sortUsers()" class="border rounded px-2 py-1 ">
          <option value="name">이름순</option>
          <option value="praises">칭찬순</option>
        </select>
      </div>
    </div>

    <div id="profileGrid" class="flex grid grid-cols-3 gap-4 mb-6"></div>
    <div id="pagination" class="flex justify-center items-center gap-1 text-sm text-gray-700"></div>
  </div>

  <script>
/* 상태 */
let page = 1, sort = 'name', q = '';

/* DOM */
const grid = document.getElementById('profileGrid');
const pager= document.getElementById('pagination');
document.getElementById('sortSelect').onchange = e => { sort=e.target.value; page=1; load(); };
document.getElementById('searchInput').oninput = e => { q=e.target.value.trim(); page=1; load(); };

/* API 호출 */
async function load(){
  const url = new URL('/api/users', location.origin);
  url.searchParams.set('sort',sort);
  url.searchParams.set('page',page);
  if(q) url.searchParams.set('q',q);

  const res = await fetch(url,{credentials:'include'});
  if(!res.ok){grid.textContent='로드 오류';return;}
  const {users,totalPages} = await res.json();
  render(users,totalPages);
}

/* 렌더 */
function render(users,total){
  /* 카드 */
  grid.innerHTML = users.map(u=>`
   <div class="bg-white rounded shadow p-4 text-center">
     <img src="${u.photo||'/static/placeholder.png'}" class="mx-auto mb-2 rounded-full w-24 h-24 object-cover">
     <h2 class="text-lg font-bold">${u.name} <span class="text-gray-500">(${u.praises})</span></h2>
     <button onclick="addPraise('${u._id}')" class="bg-gray-600 text-white px-3 py-1 rounded text-sm mr-1">칭찬</button>
     <button onclick="goProfile('${u._id}')" class="bg-gray-600 text-white px-3 py-1 rounded text-sm">보기</button>
   </div>`).join('');

  /* 페이지네이션 */
  pager.innerHTML='';
  const btn=(lbl,p,dis)=>pager.insertAdjacentHTML('beforeend',
     `<button class="px-2 py-1 ${dis?'opacity-40':''}" ${dis?'disabled':''} onclick="goto(${p})">${lbl}</button>`);
  btn('<<',1,page===1); btn('<',page-1,page===1);
  for(let i=1;i<=total;i++) pager.insertAdjacentHTML('beforeend',
     `<button class="px-2 py-1 ${i===page?'font-bold underline':''}" onclick="goto(${i})">${i}</button>`);
  btn('>',page+1,page===total); btn('>>',total,page===total);
}
window.goto = p => {page=p; load();}
window.addPraise = id => window.open(`/praise.html?to=${id}`,'p','w=400,h=450');
window.goProfile= id => location.href=`/profile/${id}`;

/* 모달 + 첫 로딩 */
 document.addEventListener('DOMContentLoaded', () => {
   //openModal();
   load();
 });
</script>

</div>